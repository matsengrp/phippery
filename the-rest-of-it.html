<!DOCTYPE html>
<html class="writer-html5" lang="en">
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.19: https://docutils.sourceforge.io/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Gotchas &mdash; phippery 0.1.0 documentation</title>
      <link rel="stylesheet" type="text/css" href="_static/pygments.css" />
      <link rel="stylesheet" type="text/css" href="_static/css/theme.css" />

  
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
        <script src="_static/jquery.js"></script>
        <script src="_static/underscore.js"></script>
        <script src="_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script src="_static/doctools.js"></script>
        <script src="_static/sphinx_highlight.js"></script>
    <script src="_static/js/theme.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="prev" title="Background Modeling" href="bkg-model.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="index.html" class="icon icon-home">
            phippery
              <img src="_static/Xarray_function.png" class="logo" alt="Logo"/>
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Overview:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="introduction.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="examples.html">Examples</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Nextflow Pipeline:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="alignments-pipeline.html">Alignments Pipeline</a></li>
<li class="toctree-l1"><a class="reference internal" href="alignments-pipeline.html#input-files">Input files</a></li>
<li class="toctree-l1"><a class="reference internal" href="alignments-pipeline.html#pipeline-results">Pipeline results</a></li>
<li class="toctree-l1"><a class="reference internal" href="alignments-pipeline.html#parameters">Parameters</a></li>
<li class="toctree-l1"><a class="reference internal" href="alignments-pipeline.html#optional-parameters">Optional Parameters</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Python API:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="phippery.utils.html">Utils</a></li>
<li class="toctree-l1"><a class="reference internal" href="phippery.normalize.html">Normalize</a></li>
<li class="toctree-l1"><a class="reference internal" href="phippery.modeling.html">Modeling</a></li>
<li class="toctree-l1"><a class="reference internal" href="phippery.eigen.html">Eigen</a></li>
<li class="toctree-l1"><a class="reference internal" href="phippery.escprof.html">Escape Profile</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Command Line Interface:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="command-line-interface.html">Command Line Interface</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Streamlit Viz App</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="streamlit-app.html">Streamlit Viz App</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Methods Descriptions</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="esc-prof.html">Comparing Escape Profiles</a></li>
<li class="toctree-l1"><a class="reference internal" href="bkg-model.html">Background Modeling</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">The Rest of It</span></p>
<ul class="current">
<li class="toctree-l1 current"><a class="current reference internal" href="#">Gotchas</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#missing-annotations-i-e-nan-s">Missing Annotations (i.e. NaN’s)</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="#contributing">Contributing</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#phippery-development-install">Phippery Development Install</a></li>
<li class="toctree-l2"><a class="reference internal" href="#pypi">PyPI</a></li>
<li class="toctree-l2"><a class="reference internal" href="#building-documentation">Building Documentation</a></li>
<li class="toctree-l2"><a class="reference internal" href="#the-data-structure">The Data Structure</a></li>
</ul>
</li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">phippery</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="index.html" class="icon icon-home" aria-label="Home"></a></li>
      <li class="breadcrumb-item active">Gotchas</li>
      <li class="wy-breadcrumbs-aside">
            <a href="_sources/the-rest-of-it.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="gotchas">
<span id="sec-dev-intro"></span><h1>Gotchas<a class="headerlink" href="#gotchas" title="Permalink to this heading"></a></h1>
<section id="missing-annotations-i-e-nan-s">
<span id="sec-missing-data"></span><h2>Missing Annotations (i.e. NaN’s)<a class="headerlink" href="#missing-annotations-i-e-nan-s" title="Permalink to this heading"></a></h2>
<p>When dealing with missing values in the annotation tables, we use the
<a class="reference external" href="https://pandas.pydata.org/docs/reference/api/pandas.DataFrame.convert_dtypes.html">pd.convert_dtypes</a>
function to best allow for missing annotations, while maintaining the integrity of
the inferred datatype. It is highly recommended you stay consistent with datatype for feature annotations,
i.e. try not to mix values like <code class="docutils literal notranslate"><span class="pre">1</span></code> (integer), <code class="docutils literal notranslate"><span class="pre">6.7</span></code> (float), and <code class="docutils literal notranslate"><span class="pre">hello_world</span></code> (string) in any one of the columns.
For missing data of any type,
The following values will be interpreted as <code class="docutils literal notranslate"><span class="pre">NaN</span></code>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>‘’, ‘#N/A’, ‘#N/A N/A’,
‘#NA’, ‘-1.#IND’, ‘-1.#QNAN’, ‘-NaN’, ‘-nan’, ‘1.#IND’, ‘1.#QNAN’, ‘&lt;NA&gt;’,
‘N/A’, ‘NA’, ‘NULL’, ‘NaN’, ‘n/a’, ‘nan’, ‘null’.
</pre></div>
</div>
</section>
</section>
<section id="contributing">
<span id="sec-contribute"></span><h1>Contributing<a class="headerlink" href="#contributing" title="Permalink to this heading"></a></h1>
<p>We welcome and encourage contributions to the pipeline.
We recommend following the same instructions
as <a class="reference external" href="https://tskit.dev/tskit/docs/stable/development.html#sec-development-workflow-git">tskit</a>
for submitting a <a class="reference external" href="https://github.com/matsengrp/phip-flow/pulls">pull request</a>.</p>
<section id="phippery-development-install">
<h2>Phippery Development Install<a class="headerlink" href="#phippery-development-install" title="Permalink to this heading"></a></h2>
<p>For activate development, and documentation, we recommend using the following
instructions inside of a virtual environment or equivalent.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>» git clone https://github.com/matsengrp/phippery.git
» (cd phippery &amp;&amp; pip install -e &quot;.[dev]&quot;)
</pre></div>
</div>
<p>Next, run the tests to make sure everything is working properly.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>» (cd phippery &amp;&amp; pytest -vv)
</pre></div>
</div>
</section>
<section id="pypi">
<h2>PyPI<a class="headerlink" href="#pypi" title="Permalink to this heading"></a></h2>
<p>This process will most likely be handled by the
maintainers of the project after a PR has been approved
and merged into main.</p>
<p>Update the version:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">bumpver</span> <span class="n">update</span> <span class="o">--</span><span class="n">patch</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>For small changes, use ``--patch``
For minor changes, use ``--minor``
For major changes, use ``--major``
</pre></div>
</div>
<p>Build the wheel</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">python</span> <span class="o">-</span><span class="n">m</span> <span class="n">build</span>
</pre></div>
</div>
<p>Use Twine to check</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">twine</span> <span class="n">check</span> <span class="n">dist</span><span class="o">/*</span>
</pre></div>
</div>
<p>Optionally, Use Twine to upload to testpypi</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">twine</span> <span class="n">upload</span> <span class="o">-</span><span class="n">r</span> <span class="n">testpypi</span> <span class="o">--</span><span class="n">verbose</span> <span class="n">dist</span><span class="o">/*</span>
</pre></div>
</div>
</section>
<section id="building-documentation">
<h2>Building Documentation<a class="headerlink" href="#building-documentation" title="Permalink to this heading"></a></h2>
<p>To edit the documentation seen here,
simply edit the respective <code class="docutils literal notranslate"><span class="pre">.rst</span></code> file
(following the git workflow described below)
in the <code class="docutils literal notranslate"><span class="pre">docs/</span></code> subdirectory. Once edited, you can check
the edits are rendered correctly by building the docs locally</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>» cd docs/
» make clean &amp;&amp; make html
</pre></div>
</div>
<p>Then open the index file built at <code class="docutils literal notranslate"><span class="pre">_build/html/index.html</span></code>
with a browser of choice to inspect changes.</p>
<p>Once the changes have been approved and merged into the main branch
the documentation will automatically build and deploy.</p>
</section>
<section id="the-data-structure">
<span id="sec-under-the-hood"></span><h2>The Data Structure<a class="headerlink" href="#the-data-structure" title="Permalink to this heading"></a></h2>
<p>The primary data structure resulting from PhIP-Seq experiments is an <em>enrichment matrix</em>,
X, with i rows and j columns.
Commonly, row index represents a peptide that is displayed on a phage,
and each column represents a sample that was mixed with the entire phage library.
After sequencing and demultiplexing each sample, we align the reads to the
oligonucleotide reference library to observe a
count of aligned reads to each peptide.</p>
<p>Outside of the enrichment matrix, each <em>sample</em> in an experiment as well as each <em>peptide</em>
in the phage library used have number of important annotations required when
performing analysis tasks like model fitting, normalizing, and differential selection.
Additionally, the comparison across groups of virus proteins and
sample types is crucial in many experiments. For large sample size experiments,
it can be difficult to cross reference each of these groups before and
after analysis.</p>
<p>Here, we take advantage of the powerful
<a class="reference external" href="http://xarray.pydata.org/en/stable/index.html">xarray</a>
approach to organizing all the Phip-Seq data along four primary coordinate
dimensions which tie all sample/peptide enrichments to the respective annotations.
Doing this allows us to store all the information without the error prone
step of cross-checking separate dataframes, and without the
large storage scaling of using “Tall” dataframes.</p>
<figure class="align-left" id="id1">
<a class="reference internal image-reference" href="_images/xarray-format.svg"><img alt="phippery xarray format" src="_images/xarray-format.svg" width="400" /></a>
<figcaption>
<p><span class="caption-text"><strong>Xarray Dataset Format</strong> A cartoon representation
of the format output by the pipeline for
we require for using phippery functions.
Concretely, for a matrix, <cite>mathcal{M}_{i}{j}</cite></span><a class="headerlink" href="#id1" title="Permalink to this image"></a></p>
</figcaption>
</figure>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="bkg-model.html" class="btn btn-neutral float-left" title="Background Modeling" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2024, Jared G. Galloway, Kevin Sung.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>